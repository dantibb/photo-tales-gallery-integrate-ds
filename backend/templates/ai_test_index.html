<!DOCTYPE html>
<html lang="en">
<head>
    <title>AI Interviewer Test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/test_dark.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
</head>
<body class="container py-4">
<!-- Bootstrap Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary rounded mb-4 shadow">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">AI Interviewer</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <!-- Avatar Container -->
    <div style="width: 180px; margin: 30px auto 10px auto; display: flex; flex-direction: column; align-items: center;">
        <div style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; border: 4px solid #007bff; box-shadow: 0 2px 8px rgba(0,0,0,0.15); background: #fff; transition: box-shadow 0.3s;">
            <div id="lottie-avatar"></div>
        </div>
        <div style="margin-top: 10px; font-weight: bold; color: #007bff;">AI Questioner</div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lottie.loadAnimation({
                container: document.getElementById('lottie-avatar'),
                renderer: 'svg',
                loop: true,
                autoplay: true,
                path: 'https://assets10.lottiefiles.com/packages/lf20_tll0j4bb.json'
            });
        });
    </script>
    <h1>Choose an Image for Interview....</h1>
    <div id="ai-question-container" class="d-none bg-primary text-white rounded shadow" style="position:relative; padding: 1.5rem 1rem; margin-bottom: 1.5rem;">
        <button type="button" class="btn-close position-absolute top-0 end-0 m-2" aria-label="Close" onclick="hideAIQuestion()"></button>
        <div id="ai-question-text" class="mb-2"></div>
        <textarea id="ai-question-answer" class="form-control mb-2" rows="3" placeholder="Your answer..."></textarea>
        <button class="btn btn-success" onclick="submitTagAnswer()">Submit</button>
    </div>
    <div class="row">
        <div class="col-12 col-md-3 mb-4 mb-md-0">
            <div class="card shadow-sm mb-4 bg-body-tertiary border-0" style="min-height: 400px;">
                <div class="px-3 pt-3 pb-2">
                    <h5 class="fw-bold text-primary mb-3" style="letter-spacing:0.5px;">Tags</h5>
                    <input type="text" class="form-control form-control-sm mb-2" id="tag-search" placeholder="Search tags..." oninput="filterTagList()">
                    <button class="btn btn-outline-danger btn-sm w-100 mb-2" onclick="clearAllTags()" type="button">
                        <i class="fas fa-trash me-1"></i>Clear All Tags
                    </button>
                </div>
                <div class="nav flex-column nav-pills px-2 pb-3" id="tag-list" role="tablist" aria-orientation="vertical">
                    <button class="nav-link active d-flex justify-content-between align-items-center mb-1" id="tag-all" onclick="filterByTag('all', this)">
                        <span>All</span> <span class="badge bg-secondary">{{ images|length }}</span>
                    </button>
                    {% for tag, count in tag_counts %}
                        <div class="d-flex align-items-center mb-1 tag-row w-100" style="gap:0.25rem;">
                            <button class="nav-link flex-grow-1 d-flex justify-content-between align-items-center text-truncate" id="tag-{{ tag }}" onclick="filterByTag('{{ tag }}', this)" style="min-width:0;">
                                <span class="text-truncate wider-tag-name">{{ tag }}</span> <span class="badge bg-light text-dark ms-2">{{ count }}</span>
                            </button>
                            <button class="btn btn-primary btn-sm px-2 py-1 d-flex align-items-center" title="Ask AI about this tag" onclick="askTagQuestion('{{ tag }}', event)">
                                <i class="fas fa-question-circle"></i> <span class="ms-1">?</span>
                            </button>
                            <button class="btn btn-danger btn-sm px-2 py-1 d-flex align-items-center" title="Remove tag" onclick="removeTag('{{ tag }}', event)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-12 col-md-9">
            <div class="row" id="image-gallery">
                {% for img in images %}
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                    <div class="card" data-tags="{{ img.tags|join(',') }}">
                        {% if img.summary_title %}
                        <div class="card-header text-center fw-bold small">{{ img.summary_title }}</div>
                        {% endif %}
                        <img src="{{ url_for('images', filename=img.name) }}" class="card-img-top" style="height:200px;object-fit:cover;">
                        <div class="card-body text-center">
                            {% if img.summary_summary %}
                            <div class="mb-2 text-muted small">{{ img.summary_summary }}</div>
                            {% endif %}
                            <a href="{{ url_for('interview', image_name=img.name) }}" class="btn btn-primary">Interview</a>
                            <button class="btn btn-sm btn-outline-info mt-2" onclick="aiTagImage('{{ img.name }}', this)">
                                <span class="spinner-border spinner-border-sm me-1" style="display:none;"></span>
                                <i class="fas fa-magic me-1"></i>AI Tag/Refresh Tag
                            </button>
                            <div class="mt-1"><strong>Tags:</strong> <span id="tags-{{ img.name }}">{{ img.tags|join(', ') if img.tags else '' }}</span></div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <script>
    function aiTagImage(imageName, btn) {
        const tagSpan = document.getElementById(`tags-${imageName}`);
        const spinner = btn.querySelector('.spinner-border');
        btn.disabled = true;
        if (spinner) spinner.style.display = 'inline-block';
        fetch(`/api/ai_tag/${imageName}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (tagSpan) tagSpan.innerText = data.tags.join(', ');
            })
            .catch(() => {
                alert('Failed to generate tags.');
            })
            .finally(() => {
                btn.disabled = false;
                if (spinner) spinner.style.display = 'none';
            });
    }
    function filterByTag(tag, btn) {
        if (tag === 'all') hideAIQuestion();
        // Remove active class from all tag buttons
        document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
        if (btn) btn.classList.add('active');
        const cards = document.querySelectorAll('#image-gallery .card');
        cards.forEach(card => {
            const tags = card.getAttribute('data-tags');
            if (tag === 'all' || (tags && tags.split(',').includes(tag))) {
                card.parentElement.style.display = '';
            } else {
                card.parentElement.style.display = 'none';
            }
        });
    }
    function removeTag(tag, event) {
        event.stopPropagation();
        if (!confirm(`Remove tag "${tag}" from all images?`)) return;
        fetch(`/api/remove_tag/${encodeURIComponent(tag)}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
    }
    function clearAllTags() {
        if (!confirm("Are you sure you want to remove all tags from all images?")) return;
        fetch('/api/clear_all_tags', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
    }
    function askTagQuestion(tag, event) {
        event.stopPropagation();
        const container = document.getElementById('ai-question-container');
        container.classList.remove('d-none');
        document.getElementById('ai-question-text').innerHTML = '<div class="text-center"><div class="spinner-border"></div></div>';
        document.getElementById('ai-question-answer').value = '';
        fetch(`/api/ai_tag_question/${encodeURIComponent(tag)}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                document.getElementById('ai-question-text').innerText = data.question;
            })
            .catch(() => {
                document.getElementById('ai-question-text').innerText = 'Failed to get question.';
            });
    }
    function hideAIQuestion() {
        document.getElementById('ai-question-container').classList.add('d-none');
    }
    function submitTagAnswer() {
        const answer = document.getElementById('ai-question-answer').value;
        alert('Your answer: ' + answer);
        hideAIQuestion();
    }
    function filterTagList() {
        const search = document.getElementById('tag-search').value.toLowerCase();
        document.querySelectorAll('.tag-row').forEach(function(row) {
            const tagText = row.querySelector('.nav-link span').textContent.toLowerCase();
            row.style.display = tagText.includes(search) ? '' : 'none';
        });
    }
    </script>
    <!-- Add subtle hover effect to cards -->
    <style>
    .card:hover {
      box-shadow: 0 6px 24px rgba(0,0,0,0.18) !important;
      transform: translateY(-2px) scale(1.02);
      transition: box-shadow 0.3s, transform 0.3s;
    }
    .btn, .list-group-item {
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
    }
    .nav-pills .nav-link.active, .nav-pills .show > .nav-link {
        background-color: #0d6efd;
        color: #fff;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(13,110,253,0.08);
    }
    .nav-pills .nav-link {
        color: #0d6efd;
        background: #f8f9fa;
        border-radius: 0.5rem;
        margin-bottom: 2px;
        transition: background 0.2s, color 0.2s;
    }
    .nav-pills .nav-link:hover {
        background: #e7f1ff;
        color: #0a58ca;
    }
    .tag-row .btn-link {
        color: #adb5bd;
        opacity: 0.7;
        transition: color 0.2s, opacity 0.2s;
    }
    .tag-row .btn-link:hover {
        color: #0d6efd;
        opacity: 1;
    }
    .tag-row {
      width: 100%;
      flex-wrap: nowrap;
    }
    .tag-row .nav-link {
      min-width: 0;
      max-width: 100%;
    }
    .tag-row .wider-tag-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: inline-block;
      max-width: 220px;
      flex-basis: 180px;
    }
    .tag-row .btn-primary, .tag-row .btn-danger {
      font-size: 1.1em;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      border-radius: 0.4rem;
      opacity: 0.95;
      transition: box-shadow 0.2s, opacity 0.2s;
      flex-shrink: 0;
    }
    .tag-row .btn-primary:hover, .tag-row .btn-danger:hover {
      opacity: 1;
      box-shadow: 0 2px 8px rgba(13,110,253,0.12);
    }
    #ai-question-container label, #ai-question-container textarea, #ai-question-container button {
      color: #212529;
    }
    #ai-question-container .form-control {
      background: #f8f9fa;
      color: #212529;
      border: none;
    }
    #ai-question-container .form-control:focus {
      background: #fff;
      color: #212529;
      box-shadow: 0 0 0 0.2rem rgba(13,110,253,.15);
    }
    #ai-question-container .btn-success {
      background: #fff;
      color: #0d6efd;
      border: none;
      font-weight: 500;
    }
    #ai-question-container .btn-success:hover {
      background: #e7f1ff;
      color: #0a58ca;
    }
    </style>
</body>
</html> 